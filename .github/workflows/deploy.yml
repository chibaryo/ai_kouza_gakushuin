name: Deploy Slidev to GitHub Pages

on:
  push:
    branches: [ main, master ]

jobs:
  deploy:
    runs-on: ubuntu-latest  # ✅ 問題なし
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'  # ✅ 最新LTS（18でも可）
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build multiple slides
        run: |
          # 各スライドをビルド
          npx slidev build slides_1.md --base /${{ github.event.repository.name }}/slides_1/ --out dist/slides_1
          npx slidev build slides_2.md --base /${{ github.event.repository.name }}/slides_2/ --out dist/slides_2
          
          # トップページ作成
          echo '<!DOCTYPE html>
          <html>
          <head><title>AI講義資料</title></head>
          <body>
            <h1>📚 AI講義資料一覧</h1>
            <ul>
              <li><a href="slides_1/">第1回: AI入門</a></li>
              <li><a href="slides_2/">第2回: 機械学習基礎</a></li>
            </ul>
          </body>
          </html>' > dist/index.html

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist